<!DOCTYPE html>  <html> <head>   <title>knex.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               knex.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>Knex.js  0.1.0

(c) 2013 Tim Griesser
Bookshelf may be freely distributed under the MIT license.
For details and documentation:
http://knexjs.org
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">Q</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><code>Knex</code> is the root namespace and a chainable function where
<code>Knex('tableName')</code> is shorthand for <code>new Knex.Builder('tableName')</code>
or <code>new Knex.Builder().from('tableName')</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Knex</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Builder</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Default client paths, located in the <code>./clients</code> directory.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Clients</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;mysql&#39;</span>    <span class="o">:</span> <span class="s1">&#39;./clients/mysql.js&#39;</span><span class="p">,</span>
    <span class="s1">&#39;postgres&#39;</span> <span class="o">:</span> <span class="s1">&#39;./clients/postgres.js&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sqlite3&#39;</span>  <span class="o">:</span> <span class="s1">&#39;./clients/sqlite3.js&#39;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Keep in sync with package.json</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Knex</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.1.0&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Knex.init</h2>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Takes a hash of options to initialize the database
connection. The <code>client</code> is required to choose which client
path above is loaded, or to specify a custom path to a client.
Other options, such as <code>connection</code> or <code>pool</code> are passed 
into <code>client.init</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Knex</span><span class="p">.</span><span class="nx">Initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{});</span>
    <span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">client</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">client</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;The client is required to use Knex.&#39;</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Checks if this is a default client. If it's not,
require it as the path to the client if it's a string,
and otherwise, set the object to the client.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">Clients</span><span class="p">[</span><span class="nx">client</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">Clients</span><span class="p">[</span><span class="nx">client</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">client</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">client</span><span class="p">);</span>  
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span> <span class="o">=</span> <span class="nx">client</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Knex.Grammar</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Creates a new Grammar, with the mixins for the
specified query dialect, which are defined in each
client's <code>exports.grammar</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Grammar</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Grammar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mixins</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The list of different components</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">components</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;aggregate&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="s1">&#39;from&#39;</span><span class="p">,</span>
    <span class="s1">&#39;joins&#39;</span><span class="p">,</span> <span class="s1">&#39;wheres&#39;</span><span class="p">,</span> <span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="s1">&#39;havings&#39;</span><span class="p">,</span>
    <span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span>
  <span class="p">];</span>

  <span class="nx">Grammar</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">tablePrefix</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>

    <span class="nx">dateFormat</span><span class="o">:</span> <span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Compiles the <code>select</code> statement, or nested sub-selects
by calling each of the component compilers, trimming out
the empties, and returning a generated query string.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileSelect</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">columns</span><span class="p">))</span> <span class="nx">qb</span><span class="p">.</span><span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">components</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">component</span> <span class="o">=</span> <span class="nx">components</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">component</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">sql</span><span class="p">[</span><span class="nx">component</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;compile&#39;</span> <span class="o">+</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">component</span><span class="p">)](</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">component</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">compact</span><span class="p">(</span><span class="nx">sql</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Compiles an aggregate query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileAggregate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">aggregate</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">column</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">columnize</span><span class="p">(</span><span class="nx">aggregate</span><span class="p">.</span><span class="nx">columns</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">isDistinct</span> <span class="o">&amp;&amp;</span> <span class="nx">column</span> <span class="o">!==</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">column</span> <span class="o">=</span> <span class="s1">&#39;distinct &#39;</span> <span class="o">+</span> <span class="nx">column</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="s1">&#39;select &#39;</span> <span class="o">+</span> <span class="nx">aggregate</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">column</span> <span class="o">+</span> <span class="s1">&#39;) as aggregate&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Compiles the columns in the query, specifying if an item was distinct.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileColumns</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">columns</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">aggregate</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">isDistinct</span> <span class="o">?</span> <span class="s1">&#39;select distinct &#39;</span> <span class="o">:</span> <span class="s1">&#39;select &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">columnize</span><span class="p">(</span><span class="nx">columns</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Compiles the <code>from</code> tableName portion of the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileFrom</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;from &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Compiles all each of the <code>join</code> clauses on the query, 
including any nested join queries.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileJoins</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">joins</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">joins</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">join</span> <span class="o">=</span> <span class="nx">joins</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">clauses</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l2</span> <span class="o">=</span> <span class="nx">join</span><span class="p">.</span><span class="nx">clauses</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i2</span> <span class="o">&lt;</span> <span class="nx">l2</span><span class="p">;</span> <span class="nx">i2</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">clause</span> <span class="o">=</span> <span class="nx">join</span><span class="p">.</span><span class="nx">clauses</span><span class="p">[</span><span class="nx">i2</span><span class="p">];</span>
          <span class="nx">clauses</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
            <span class="p">[</span><span class="nx">clause</span><span class="p">[</span><span class="s1">&#39;bool&#39;</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">clause</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]),</span> <span class="nx">clause</span><span class="p">.</span><span class="nx">operator</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">clause</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">])].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
          <span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">clauses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">clauses</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/and |or /</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">sql</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">join</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39; join &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">join</span><span class="p">.</span><span class="nx">table</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; on &#39;</span> <span class="o">+</span> <span class="nx">clauses</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Compiles all <code>where</code> statements on the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileWheres</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">wheres</span> <span class="o">=</span> <span class="nx">qb</span><span class="p">.</span><span class="nx">wheres</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">wheres</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">where</span> <span class="o">=</span> <span class="nx">wheres</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">sql</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">bool</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;where&#39;</span> <span class="o">+</span> <span class="nx">where</span><span class="p">.</span><span class="nx">type</span><span class="p">](</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">sql</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;where &#39;</span> <span class="o">+</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/and |or /</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Compiles a nested where clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNested</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileWheres</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">query</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Compiles a nested where clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereSub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">where</span><span class="p">.</span><span class="nx">operator</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">compileSelect</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">query</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Compiles a basic where clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereBasic</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">where</span><span class="p">.</span><span class="nx">operator</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameter</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Compiles a basic exists clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;exists (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileSelect</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Compiles a basic not exists clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNotExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;not exists (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileSelect</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Compiles a where in clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereIn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; in (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameterize</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Compiles a where not in clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNotIn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; not in (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameterize</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Compiles a sub-where in clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereInSub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; in (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileSelect</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Compiles a sub-where not in clause.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNotInSub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; not in (&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileSelect</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">whereNull</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is null&#39;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">whereNotNull</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">where</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is not null&#39;</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">whereRaw</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">where</span><span class="p">.</span><span class="nx">sql</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Compiles the <code>group by</code> columns.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileGroups</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">groups</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;group by &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">columnize</span><span class="p">(</span><span class="nx">groups</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Compiles the <code>having</code> statements.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileHavings</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">havings</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;having &#39;</span> <span class="o">+</span> <span class="nx">havings</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">having</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">having</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">having</span><span class="p">.</span><span class="nx">operator</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameter</span><span class="p">(</span><span class="nx">having</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]);</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; and&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/and /</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Compiles the <code>order by</code> statements.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileOrders</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">orders</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">orders</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;order by &#39;</span> <span class="o">+</span> <span class="nx">orders</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">order</span><span class="p">.</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">direction</span><span class="p">;</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Compiles the <code>limit</code> statements.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileLimit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;limit &#39;</span> <span class="o">+</span> <span class="nx">limit</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Compiles an <code>offset</code> statement on the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileOffset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;offset &#39;</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Compiles an <code>insert</code> query, allowing for multiple
inserts using a single query statement.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileInsert</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">values</span> <span class="o">=</span> <span class="nx">_arr</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">table</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">columnize</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
      <span class="kd">var</span> <span class="nx">parameters</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameterize</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      
      <span class="kd">var</span> <span class="nx">paramBlocks</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">paramBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nx">parameters</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="s2">&quot;insert into &quot;</span> <span class="o">+</span> <span class="nx">table</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nx">columns</span> <span class="o">+</span> <span class="s2">&quot;) values &quot;</span> <span class="o">+</span> <span class="nx">paramBlocks</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Compiles an <code>insert</code>, getting the id of the insert row.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileInsertGetId</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileInsert</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Compiles an <code>update</code> query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileUpdate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">table</span><span class="p">),</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="nx">columns</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameter</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="s1">&#39;update &#39;</span> <span class="o">+</span> <span class="nx">table</span> <span class="o">+</span> <span class="s1">&#39; set &#39;</span> <span class="o">+</span> <span class="nx">columns</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileWheres</span><span class="p">(</span><span class="nx">qb</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">compileDelete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">table</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">where</span> <span class="o">=</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">wheres</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">compileWheres</span><span class="p">(</span><span class="nx">qb</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="k">return</span> <span class="s1">&#39;delete from &#39;</span> <span class="o">+</span> <span class="nx">table</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">where</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">compileTruncate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">qb</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;truncate &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">qb</span><span class="p">.</span><span class="nx">from</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">wrap</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">segments</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isExpression</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; as &#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">segments</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; as &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">segments</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">wrapped</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">segments</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">segments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">segments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">segments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">wrapped</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">wrapped</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapValue</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">wrapped</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">wrapArray</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">wrapTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isExpression</span><span class="p">(</span><span class="nx">table</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">table</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tablePrefix</span> <span class="o">+</span> <span class="nx">table</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">columnize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">,</span> <span class="k">this</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">parameterize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameter</span><span class="p">,</span> <span class="k">this</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">parameter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isExpression</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">?</span> <span class="nx">value</span><span class="p">.</span><span class="nx">value</span> <span class="o">:</span> <span class="s1">&#39;?&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">isExpression</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Raw</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h2>Knex.Builder</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Builder</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Builder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">table</span> <span class="o">=</span> <span class="nx">table</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Grammar</span><span class="p">(</span><span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">grammar</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>All operators used in the <code>where</code> clause generation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">operators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">];</span>

  <span class="nx">Builder</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">idAttr</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Sets the <code>tableName</code> on the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">from</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tableName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tableName</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">table</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">table</span> <span class="o">=</span> <span class="nx">tableName</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Set the <code>idAttribute</code> for the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">idAttribute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">idAttr</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Adds a <code>distinct</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">distinct</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isDistinct</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Clones the current query builder, including any
pieces that have been set thus far</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">clone</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Builder</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">table</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;isDistinct&#39;</span><span class="p">,</span> <span class="s1">&#39;idAttr&#39;</span><span class="p">,</span> <span class="s1">&#39;currentPage&#39;</span><span class="p">,</span> <span class="s1">&#39;joins&#39;</span><span class="p">,</span>
        <span class="s1">&#39;wheres&#39;</span><span class="p">,</span> <span class="s1">&#39;orders&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="s1">&#39;bindings&#39;</span><span class="p">,</span>
        <span class="s1">&#39;grammar&#39;</span><span class="p">,</span> <span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="s1">&#39;transaction&#39;</span>
      <span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">item</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">item</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Resets all attributes on the query builder.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">joins</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">orders</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">columns</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">bindings</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">idAttr</span> <span class="o">=</span> <span class="nx">Builder</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">idAttr</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isDistinct</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Adds a join clause to the query, allowing for advanced joins
with an anonymous function as the second argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">join</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">first</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">join</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">first</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="nx">operator</span><span class="p">;</span>
        <span class="nx">join</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JoinClause</span><span class="p">((</span><span class="nx">type</span> <span class="o">||</span> <span class="s1">&#39;inner&#39;</span><span class="p">),</span> <span class="nx">table</span><span class="p">);</span>
        <span class="nx">first</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">join</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">join</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JoinClause</span><span class="p">((</span><span class="nx">type</span> <span class="o">||</span> <span class="s1">&#39;inner&#39;</span><span class="p">),</span> <span class="nx">table</span><span class="p">);</span>
        <span class="nx">join</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">second</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">joins</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">join</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>The where function can be used in several ways:
The most basic is <code>where(key, value)</code>, which expands to
where key = value. </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">where</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">type</span><span class="p">;</span>
      <span class="nx">bool</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">=</span> <span class="s1">&#39;and&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">column</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_whereNested</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">bool</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">column</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">column</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
          <span class="k">this</span><span class="p">[</span><span class="nx">bool</span> <span class="o">+</span> <span class="s1">&#39;Where&#39;</span><span class="p">](</span><span class="nx">key</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">operators</span><span class="p">,</span> <span class="nx">operator</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">operator</span><span class="p">;</span>
        <span class="nx">operator</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_whereSub</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">bool</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;Basic&#39;</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
        <span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span>
        <span class="nx">operator</span><span class="o">:</span> <span class="nx">operator</span><span class="p">,</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
        <span class="nx">bool</span><span class="o">:</span> <span class="nx">bool</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Alias to <code>where</code>, for internal builder consistency.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">andWhere</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">where</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">whereRaw</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">bindings</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bindings</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bindings</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">bool</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">=</span> <span class="s1">&#39;and&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="nx">sql</span><span class="o">:</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">bool</span><span class="o">:</span><span class="nx">bool</span><span class="p">});</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">bindings</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>      
    <span class="p">},</span>

    <span class="nx">orWhereRaw</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">bindings</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereRaw</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">bindings</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Adds an <code>or where</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhere</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Adds a <code>where exists</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Builder</span><span class="p">();</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="p">(</span><span class="nx">type</span> <span class="o">||</span> <span class="s1">&#39;Exists&#39;</span><span class="p">),</span>
        <span class="nx">query</span><span class="o">:</span> <span class="nx">query</span><span class="p">,</span>
        <span class="nx">bool</span><span class="o">:</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">||</span> <span class="s1">&#39;and&#39;</span><span class="p">)</span>
      <span class="p">});</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">query</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Adds an <code>or where exists</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhereExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">condition</span> <span class="o">?</span> <span class="s1">&#39;NotExists&#39;</span> <span class="o">:</span> <span class="s1">&#39;Exists&#39;</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereExists</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="s1">&#39;NotExists&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Adds a <code>where not exists</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNotExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bool</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">=</span> <span class="s1">&#39;and&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereExists</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Adds a <code>or where not exists</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhereNotExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">orWhereExists</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Adds a <code>where in</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereIn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bool</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">=</span> <span class="s1">&#39;and&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">condition</span> <span class="o">?</span> <span class="s1">&#39;NotIn&#39;</span> <span class="o">:</span> <span class="s1">&#39;In&#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">values</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_whereInSub</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="s1">&#39;not&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
        <span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span>
        <span class="nx">values</span><span class="o">:</span> <span class="nx">values</span><span class="p">,</span>
        <span class="nx">bool</span><span class="o">:</span> <span class="nx">bool</span>
      <span class="p">});</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Adds a <code>or where in</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhereIn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereIn</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Adds a <code>where not in</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNotIn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereIn</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Adds a <code>or where not in</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhereNotIn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereNotIn</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Adds a <code>where null</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNull</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="p">(</span><span class="nx">type</span> <span class="o">||</span> <span class="s1">&#39;Null&#39;</span><span class="p">),</span> <span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span> <span class="nx">bool</span><span class="o">:</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">||</span> <span class="s1">&#39;and&#39;</span><span class="p">)});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Adds a <code>or where null</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhereNull</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereNull</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Adds a <code>where not null</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereNotNull</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereNull</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">||</span> <span class="s1">&#39;and&#39;</span><span class="p">),</span> <span class="s1">&#39;NotNull&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Adds a <code>or where not null</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhereNotNull</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereNotNull</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Adds a <code>where between</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">whereBetween</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;between&#39;</span><span class="p">,</span> <span class="nx">bool</span><span class="o">:</span> <span class="nx">bool</span><span class="p">});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Adds a <code>or where between</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orWhereBetween</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">whereBetween</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Adds a <code>group by</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">groupBy</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">groups</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Adds a <code>order by</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">orderBy</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span> <span class="nx">direction</span><span class="o">:</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">||</span> <span class="s1">&#39;asc&#39;</span><span class="p">)});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Adds a <code>having</code> clause to the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">having</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">havings</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span> <span class="nx">operator</span><span class="o">:</span> <span class="p">(</span><span class="nx">operator</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">value</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">)});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">offset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isOffset</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isOffset</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">limit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">isLimit</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isLimit</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Determine if any rows exist for the current query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">exists</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Retrieve the "count" result of the query.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">count</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_aggregate</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Retrieve the minimum value of a given column.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">min</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_aggregate</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Retrieve the maximum value of a given column.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">max</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_aggregate</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Retrieve the sum of the values of a given column.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">sum</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_aggregate</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Increments a column's value by the specified amount.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">increment</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_counter</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Decrements a column's value by the specified amount.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">decrement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_counter</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Performs a <code>select</code> query, returning a promise.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">select</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">columns</span> <span class="o">||</span> <span class="p">(</span><span class="nx">columns</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">);</span>
      <span class="nx">columns</span> <span class="o">=</span> <span class="nx">_arr</span><span class="p">(</span><span class="nx">columns</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">columns</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">columns</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span><span class="nx">sql</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">compileSelect</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">bindings</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cleanBindings</span><span class="p">()});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Performs an <code>INSERT</code> query, returning a promise.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">insert</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="nx">returning</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">str</span><span class="p">;</span>
      <span class="nx">returning</span> <span class="o">||</span> <span class="p">(</span><span class="nx">returning</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">idAttr</span><span class="p">);</span>
      <span class="nx">values</span> <span class="o">=</span> <span class="nx">_arr</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">bindings</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">record</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">returning</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">str</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">compileInsertGetId</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">returning</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">str</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">compileInsert</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">values</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span><span class="nx">sql</span><span class="o">:</span> <span class="nx">str</span><span class="p">,</span> <span class="nx">bindings</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cleanBindings</span><span class="p">()});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Performs an <code>update</code> query, returning a promise.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">bindings</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span><span class="nx">sql</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">compileUpdate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">values</span><span class="p">),</span> <span class="nx">bindings</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cleanBindings</span><span class="p">()});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Executes a delete statement on the query;</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;delete&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">del</span><span class="p">();</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Alias to delete</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">del</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span><span class="nx">sql</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">compileDelete</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="nx">bindings</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cleanBindings</span><span class="p">()});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Truncate</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">truncate</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span><span class="nx">sql</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">compileTruncate</span><span class="p">(</span><span class="k">this</span><span class="p">)});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Set by <code>transacting</code> - contains the object with the connection
needed to execute a transaction</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transaction</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Sets the current Builder connection to that of the
the currently running transaction</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transacting</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">transaction</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_whereInSub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="nx">condition</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">condition</span> <span class="o">?</span> <span class="s1">&#39;NotInSub&#39;</span> <span class="o">:</span> <span class="s1">&#39;InSub&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Builder</span><span class="p">();</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span> <span class="nx">query</span><span class="o">:</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">bool</span><span class="o">:</span> <span class="nx">bool</span><span class="p">});</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">query</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_whereNested</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Builder</span><span class="p">();</span>
      <span class="nx">query</span><span class="p">.</span><span class="nx">table</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">table</span><span class="p">;</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Nested&#39;</span><span class="p">,</span> <span class="nx">query</span><span class="o">:</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">bool</span><span class="o">:</span> <span class="nx">bool</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">bindings</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_whereSub</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Builder</span><span class="p">();</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">wheres</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;Sub&#39;</span><span class="p">,</span>
        <span class="nx">column</span><span class="o">:</span> <span class="nx">column</span><span class="p">,</span>
        <span class="nx">operator</span><span class="o">:</span> <span class="nx">operator</span><span class="p">,</span>
        <span class="nx">query</span><span class="o">:</span> <span class="nx">query</span><span class="p">,</span>
        <span class="nx">bool</span><span class="o">:</span> <span class="nx">bool</span>
      <span class="p">});</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">query</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">_aggregate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">columns</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">aggregate</span> <span class="o">=</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">columns</span><span class="o">:</span> <span class="nx">columns</span><span class="p">};</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">columns</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_counter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">symbol</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="nx">sql</span><span class="p">[</span><span class="nx">column</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">symbol</span> <span class="o">||</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">amount</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Returns all bindings excluding the <code>Knex.Raw</code> types.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_cleanBindings</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bindings</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">binding</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">binding</span> <span class="k">instanceof</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Raw</span> <span class="o">?</span> <span class="k">void</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">binding</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>

  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <h2>Knex.JoinClause</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Used internally by the </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">JoinClause</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">JoinClause</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clauses</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">table</span> <span class="o">=</span> <span class="nx">table</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">JoinClause</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">clauses</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">first</span><span class="o">:</span> <span class="nx">first</span><span class="p">,</span> <span class="nx">operator</span><span class="o">:</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">second</span><span class="o">:</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">bool</span><span class="o">:</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">||</span> <span class="s1">&#39;and&#39;</span><span class="p">)});</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">orOn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">second</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">operator</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <h2>Knex.Transaction</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Takes an anonymous function, which</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Knex</span><span class="p">.</span><span class="nx">Transaction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Initiate a deferred object, so we know when the
transaction completes or fails, we know what to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Finish the transaction connection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">finish</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">deferred</span><span class="p">[</span><span class="nx">type</span><span class="p">](</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Call the container with the transaction
commit &amp; rollback objects</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">container</span><span class="p">({</span>
      <span class="nx">commit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">finish</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;resolve&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span> <span class="p">},</span>
      <span class="nx">rollback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">finish</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;reject&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span> <span class="p">},</span>
      <span class="nx">connection</span><span class="o">:</span> <span class="nx">connection</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <h2>Knex.Schema</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Top level object for Schema related functions</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Schema</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Attach main static methods, which passthrough to the
SchemaBuilder instance methods</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="s1">&#39;createTable&#39;</span><span class="p">,</span> <span class="s1">&#39;dropTable&#39;</span><span class="p">,</span> <span class="s1">&#39;dropTableIfExists&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;transacting&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">Schema</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SchemaBuilder</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">builder</span><span class="p">[</span><span class="nx">method</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">builder</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">});</span>

  </pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <h2>Knex.SchemaBuilder</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">SchemaBuilder</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">SchemaBuilder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">SchemaGrammar</span><span class="p">(</span><span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">schemaGrammar</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">SchemaBuilder</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    
    <span class="nx">_connection</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

    <span class="nx">transaction</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Connection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">connection</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_connection</span> <span class="o">||</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getConnection</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_connection</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Used before a builder call, specifying if this call
is nested inside a transaction</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">transacting</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">transaction</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Determine if the given table exists.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">hasTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sql</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">.</span><span class="nx">compileTableExists</span><span class="p">();</span>
      <span class="nx">table</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">getTablePrefix</span><span class="p">()</span> <span class="o">+</span> <span class="nx">table</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
      <span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span><span class="nx">sql</span><span class="o">:</span> <span class="nx">sql</span><span class="p">,</span> <span class="nx">bindings</span><span class="o">:</span> <span class="p">[</span><span class="nx">table</span><span class="p">]}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">resp</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Table&#39;</span> <span class="o">+</span> <span class="nx">table</span> <span class="o">+</span> <span class="s1">&#39; does not exist&#39;</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Modify a table on the schema.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">table</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">createBlueprint</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">callback</span><span class="p">));</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Create a new table on the schema.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">createTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">blueprint</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createBlueprint</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>
      <span class="nx">blueprint</span><span class="p">.</span><span class="nx">createTable</span><span class="p">();</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>Drop a table from the schema.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">blueprint</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createBlueprint</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>
      <span class="nx">blueprint</span><span class="p">.</span><span class="nx">dropTable</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Drop a table from the schema if it exists.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropTableIfExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">blueprint</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createBlueprint</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>
      <span class="nx">blueprint</span><span class="p">.</span><span class="nx">dropTableIfExists</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Rename a table on the schema.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">renameTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">blueprint</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createBlueprint</span><span class="p">(</span><span class="nx">from</span><span class="p">);</span>
      <span class="nx">blueprint</span><span class="p">.</span><span class="nx">renameTable</span><span class="p">(</span><span class="nx">to</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">);</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Execute the blueprint to build / modify the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">build</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">blueprint</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">connection</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">grammar</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Create a new command set with a Closure.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">createBlueprint</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Blueprint</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <h2>Knex.SchemaGrammar</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">SchemaGrammar</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">SchemaGrammar</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mixins</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">mixins</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">SchemaGrammar</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Grammar</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Compile a foreign key command.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">compileForeign</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">,</span> <span class="nx">command</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">on</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">on</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>We need to prepare several of the elements of the foreign key definition
before we can create the SQL, such as wrapping the tables and convert
an array of columns to comma-delimited strings for the SQL queries.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">columnize</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">columns</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">onColumns</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">columnize</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">references</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="s2">&quot;alter table &quot;</span> <span class="o">+</span> <span class="nx">table</span> <span class="o">+</span> <span class="s2">&quot; add constraint &quot;</span> <span class="o">+</span> <span class="nx">command</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">;</span>
          <span class="nx">sql</span> <span class="o">+=</span> <span class="s2">&quot;foreign key (&quot;</span> <span class="o">+</span> <span class="nx">columns</span> <span class="o">+</span> <span class="s2">&quot;) references &quot;</span> <span class="o">+</span> <span class="nx">on</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nx">onColumns</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>Once we have the basic foreign key creation statement constructed we can
build out the syntax for what should happen on an update or delete of
the affected columns, which will get something like "cascade", etc.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">)</span> <span class="nx">sql</span> <span class="o">+=</span> <span class="s2">&quot; on delete &quot;</span> <span class="o">+</span> <span class="nx">command</span><span class="p">.</span><span class="nx">onDelete</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">)</span> <span class="nx">sql</span> <span class="o">+=</span> <span class="s2">&quot; on update &quot;</span> <span class="o">+</span> <span class="nx">command</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">;</span>

      <span class="k">return</span> <span class="nx">sql</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Each of the column types have their own compiler functions which are
responsible for turning the column definition into its SQL format
for the platform. Then column modifiers are compiled and added.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getColumns</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">blueprint</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">column</span> <span class="o">=</span> <span class="nx">blueprint</span><span class="p">.</span><span class="nx">columns</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">getType</span><span class="p">(</span><span class="nx">column</span><span class="p">);</span>
        <span class="nx">columns</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">addModifiers</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">blueprint</span><span class="p">,</span> <span class="nx">column</span><span class="p">));</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">columns</span><span class="p">;</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Add the column modifiers to the definition.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">addModifiers</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">blueprint</span><span class="p">,</span> <span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">modifier</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modifiers</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="s2">&quot;modify&quot;</span> <span class="o">+</span> <span class="nx">modifier</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">method</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">sql</span> <span class="o">+=</span> <span class="k">this</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="nx">blueprint</span><span class="p">,</span> <span class="nx">column</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">sql</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Get the primary key command if it exists on the blueprint.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getCommandByName</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">commands</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCommandsByName</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">commands</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Get all of the commands with a given name.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getCommandsByName</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">blueprint</span><span class="p">.</span><span class="nx">commands</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">name</span><span class="p">;</span> <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Get the SQL for the column data type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getType</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="s2">&quot;type&quot;</span> <span class="o">+</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">column</span><span class="p">.</span><span class="nx">type</span><span class="p">)](</span><span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>Add a prefix to an array of values.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">prefixArray</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span> <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Wrap a table in keyword identifiers.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">wrapTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">table</span> <span class="k">instanceof</span> <span class="nx">Blueprint</span><span class="p">)</span> <span class="nx">table</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">table</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Grammar</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">wrapTable</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">table</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Wrap a value in keyword identifiers.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">wrap</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">Chainable</span><span class="p">)</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">Grammar</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">wrap</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>Format a value so that it can be used in "default" clauses.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getDefaultValue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="nx">value</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <h2>Knex.SchemaBlueprint</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Blueprint</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">.</span><span class="nx">SchemaBlueprint</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">table</span> <span class="o">=</span> <span class="nx">table</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">columns</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">commands</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">Blueprint</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    
    <span class="nx">build</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">grammar</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">statements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toSql</span><span class="p">(</span><span class="nx">grammar</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">promises</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">statements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">statement</span> <span class="o">=</span> <span class="nx">statements</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">promises</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span><span class="nx">sql</span><span class="o">:</span> <span class="nx">statement</span><span class="p">}));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">promises</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>Get the raw sql statements for the blueprint.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">toSql</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grammar</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>Add the commands that are implied by the blueprint.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">creating</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">new</span> <span class="nx">Chainable</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;add&#39;</span><span class="p">}));</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>Add indicies</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">column</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">indices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">];</span>
        
        <span class="nx">continueIndex</span><span class="o">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l2</span> <span class="o">=</span> <span class="nx">indices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i2</span> <span class="o">&lt;</span> <span class="nx">l2</span><span class="p">;</span> <span class="nx">i2</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">indices</span><span class="p">[</span><span class="nx">i2</span><span class="p">];</span>
          </pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>If the index has been specified on the given column, but is simply
equal to "true" (boolean), no name has been specified for this
index, so we will simply call the index methods without one.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">column</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">[</span><span class="nx">index</span><span class="p">](</span><span class="nx">column</span><span class="p">);</span>
            <span class="k">continue</span> <span class="nx">continueIndex</span><span class="p">;</span>
          </pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>If the index has been specified on the column and it is something
other than boolean true, we will assume a name was provided on
the index specification, and pass in the name to the method.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">index</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">[</span><span class="nx">index</span><span class="p">](</span><span class="nx">column</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">column</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
            <span class="k">continue</span> <span class="nx">continueIndex</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">statements</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>Each type of command has a corresponding compiler function on the schema
grammar which is used to build the necessary SQL statements to build
the blueprint element, so we'll just call that compilers function.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">command</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;compile&#39;</span> <span class="o">+</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">grammar</span><span class="p">,</span> <span class="nx">method</span><span class="p">))</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="nx">grammar</span><span class="p">[</span><span class="nx">method</span><span class="p">](</span><span class="k">this</span><span class="p">,</span> <span class="nx">command</span><span class="p">);</span>
          <span class="nx">statements</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">sql</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">statements</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>Determine if the blueprint has a create command.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">creating</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">command</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">command</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">command</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;createTable&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>Indicate that the table needs to be created.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">createTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addCommand</span><span class="p">(</span><span class="s1">&#39;createTable&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>Indicate that the table should be dropped.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addCommand</span><span class="p">(</span><span class="s1">&#39;dropTable&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>Indicate that the table should be dropped if it exists.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropTableIfExists</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addCommand</span><span class="p">(</span><span class="s1">&#39;dropTableIfExists&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>Indicate that the given columns should be dropped.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropColumn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addCommand</span><span class="p">(</span><span class="s1">&#39;dropColumn&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">columns</span><span class="o">:</span> <span class="nx">_arr</span><span class="p">(</span><span class="nx">columns</span><span class="p">)});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>Indicate that the given columns should be dropped.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropColumns</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">dropColumn</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>Indicate that the given primary key should be dropped.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropPrimary</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dropIndexCommand</span><span class="p">(</span><span class="s1">&#39;dropPrimary&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>Indicate that the given unique key should be dropped.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropUnique</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dropIndexCommand</span><span class="p">(</span><span class="s1">&#39;dropUnique&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>Indicate that the given index should be dropped.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropIndex</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dropIndexCommand</span><span class="p">(</span><span class="s1">&#39;dropIndex&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>Indicate that the given foreign key should be dropped.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dropForeign</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dropIndexCommand</span><span class="p">(</span><span class="s1">&#39;dropForeign&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>Rename the table to a given name.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">renameTable</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addCommand</span><span class="p">(</span><span class="s1">&#39;renameTable&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">to</span><span class="o">:</span> <span class="nx">to</span><span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Specify the primary key(s) for the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">primary</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexCommand</span><span class="p">(</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>Specify a unique index for the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unique</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexCommand</span><span class="p">(</span><span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>Specify an index for the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexCommand</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>Specify a foreign key for the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">foreign</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexCommand</span><span class="p">(</span><span class="s1">&#39;foreign&#39;</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>Create a new auto-incrementing column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">increments</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">integer</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>Create a new string column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">string</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">,</span> <span class="p">{</span><span class="nx">length</span><span class="o">:</span> <span class="p">(</span><span class="nx">length</span> <span class="o">||</span> <span class="mi">255</span><span class="p">)});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>Create a new text column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">text</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>Create a new integer column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">integer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">autoIncrement</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">,</span> <span class="p">{</span><span class="nx">autoIncrement</span><span class="o">:</span> <span class="p">(</span><span class="nx">autoIncrement</span> <span class="o">||</span> <span class="kc">false</span><span class="p">)});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>Create a new float column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kr">float</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">total</span><span class="p">,</span> <span class="nx">places</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">,</span> <span class="p">{</span><span class="nx">total</span><span class="o">:</span> <span class="p">(</span><span class="nx">total</span> <span class="o">||</span> <span class="mi">8</span><span class="p">),</span> <span class="nx">places</span><span class="o">:</span> <span class="p">(</span><span class="nx">places</span> <span class="o">||</span> <span class="mi">2</span><span class="p">)});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>Create a new decimal column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">decimal</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">precision</span><span class="p">,</span> <span class="nx">scale</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;decimal&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">,</span> <span class="p">{</span><span class="nx">precision</span><span class="o">:</span> <span class="p">(</span><span class="nx">precision</span> <span class="o">||</span> <span class="mi">8</span><span class="p">),</span> <span class="nx">scale</span><span class="o">:</span> <span class="p">(</span><span class="nx">scale</span> <span class="o">||</span> <span class="mi">2</span><span class="p">)});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>Create a new boolean column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kr">boolean</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bool</span><span class="p">(</span><span class="nx">columns</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>Alias to "boolean".</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">bool</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>Create a new date column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">date</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Create a new date-time column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dateTime</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;dateTime&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>Create a new time column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">time</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>Create a new timestamp column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">timestamp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>Add creation and update timestamps to the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">timestamps</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">(</span><span class="s1">&#39;updated_at&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>Create a new enum column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s2">&quot;enum&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">,</span> <span class="nx">allowed</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">enu</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>Alias to enum.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">enu</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;enum&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">,</span> <span class="p">{</span><span class="nx">allowed</span><span class="o">:</span> <span class="nx">allowed</span><span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>Create a new binary column on the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">binary</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addColumn</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="nx">column</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>Create a new drop index command on the blueprint.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_dropIndexCommand</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">index</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">columns</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexCommand</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>Add a new index command to the blueprint.
If no name was specified for this index, we will create one using a basic
convention of the table name, followed by the columns, followed by an
index type, such as primary or index, which makes the index unique.    </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_indexCommand</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">||</span> <span class="p">(</span><span class="nx">index</span> <span class="o">=</span> <span class="kc">null</span><span class="p">);</span>
      <span class="nx">columns</span> <span class="o">=</span> <span class="nx">_arr</span><span class="p">(</span><span class="nx">columns</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_createIndexName</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">columns</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addCommand</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="p">{</span><span class="nx">index</span><span class="o">:</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">columns</span><span class="o">:</span> <span class="nx">columns</span><span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>Create a default index name for the table.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_createIndexName</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">columns</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">table</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">targets</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">table</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\.|-/g</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">table</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">columns</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">type</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>Add a new column to the blueprint.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_addColumn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">parameters</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">},</span> <span class="nx">parameters</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">column</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Chainable</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">column</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">column</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>Add a new command to the blueprint.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_addCommand</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">parameters</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Chainable</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">},</span> <span class="nx">parameters</span><span class="p">));</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">commands</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">command</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>Chainable object used in creating SchemaBuilder commands.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Chainable</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">Chainable</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>Sets the default value for a column.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">defaultTo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">defaultValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Sets an integer as unsigned, is a no-op
if the column type is not an integer.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">unsigned</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isUnsigned</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span>
    </pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>Allows the column to contain null values.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">nullable</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">isNullable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <h2>Helpers</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">capitalize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">word</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">word</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">word</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>Ensures the value is returned as an array</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">_arr</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">val</span><span class="p">];</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <h2>Knex.Raw</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Knex</span><span class="p">.</span><span class="nx">Raw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <h2>Knex.runQuery</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>Query runner, the context of this function is set to the caller,
(either Builder or SchemaBuilder). Checks and fails on an already
resolved transaction, otherwise calls the query on the specified client 
and returns a deferred promise.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Knex</span><span class="p">.</span><span class="nx">runQuery</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">builder</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">builder</span><span class="p">.</span><span class="nx">transaction</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;The transaction has already completed.&#39;</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
    <span class="nx">Knex</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">sql</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">bindings</span> <span class="o">||</span> <span class="p">[]),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Knex</span><span class="p">.</span><span class="nx">lastQuery</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">sql</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">resp</span><span class="p">);</span>
    <span class="p">},</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">connection</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>Export the Knex module</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Knex</span><span class="p">;</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 